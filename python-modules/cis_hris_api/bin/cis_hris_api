#!/usr/bin/env python3

import sys
import json
import logging
import os
import subprocess
sys.path.append(os.getcwd())


from cis_hris_api.v2_api import app
from cis_hris_api.common import get_config
from cis_hris_api.common import find_or_create
from cis_hris_api.common import connect
from cis_hris_api.common import get_table_resource
from cis_hris_api.user import Profile


def setup_logging():
    logger = logging.getLogger()
    for h in logger.handlers:
        logger.removeHandler(h)
    h = logging.StreamHandler(sys.stdout)
    FORMAT = '%(message)s'
    h.setFormatter(logging.Formatter(FORMAT))
    logger.addHandler(h)
    logger.setLevel(logging.INFO)
    return logger


if __name__ == "__main__":
    logger = setup_logging()
    config = get_config()
    table = get_table_resource()
    find_or_create()
    fh = open('tests/fixture/workday.json')
    file_content = json.loads(fh.read())
    fh.close()
    seeds = file_content
    Profile(table).seed(seeds)
    app.run(port=config('hris_api_port', namespace='cis', default='8400'))
